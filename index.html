<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>撮影本番（Injection）音声ガイド</title>
<style>
  :root {
    --border:#d9d9d9;
    --text:#111;
    --muted:#666;
    --bg:#fff;
    --chip:#f5f5f7;
    --btn:#ffffff;
    --shadow: 0 1px 2px rgba(0,0,0,.06);
    --radius: 16px;
  }
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Hiragino Sans", "Segoe UI", Roboto, "Noto Sans JP", "Noto Sans", Arial, sans-serif;
    margin: 18px;
    line-height: 1.6;
    color: var(--text);
    background: var(--bg);
  }
  h1 {
    margin: 0 0 6px;
    font-size: 24px;
    letter-spacing: .2px;
  }
  .note {
    margin: 0 0 14px;
    color: var(--muted);
    font-size: 14px;
  }
  .panel {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    box-shadow: var(--shadow);
    max-width: 980px;
  }
  .toprow {
    display: flex;
    gap: 12px;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 10px;
  }
  .chip {
    background: var(--chip);
    border: 1px solid var(--border);
    padding: 8px 12px;
    border-radius: 999px;
    font-size: 14px;
    color: #333;
  }
  .row {
    display:flex;
    gap:12px;
    align-items:center;
    flex-wrap: wrap;
    margin: 10px 0 12px;
  }
  select {
    flex: 1 1 520px;
    min-width: 260px;
    padding: 12px 12px;
    border: 1px solid var(--border);
    border-radius: 12px;
    font-size: 16px;
    background: #fff;
  }
  .navbtn {
    padding: 10px 14px;
    border-radius: 12px;
    border: 1px solid var(--border);
    background: var(--btn);
    font-size: 16px;
    cursor: pointer;
  }
  .navbtn:disabled {
    opacity: .4;
    cursor: not-allowed;
  }
  .sectionlabel {
    margin: 12px 0 6px;
    font-size: 13px;
    color: var(--muted);
  }
  .jptext {
    font-size: 26px;
    font-weight: 700;
    margin: 0 0 10px;
  }
  .entext {
    font-size: 20px;
    margin: 0 0 12px;
  }
  .btnrow {
    display:flex;
    gap: 10px;
    flex-wrap: wrap;
    margin: 6px 0 10px;
  }
  .playbtn {
    padding: 12px 16px;
    border-radius: 14px;
    border: 1px solid var(--border);
    background: #f0f6ff;
    font-size: 16px;
    cursor:pointer;
  }
  .ghostbtn {
    padding: 12px 16px;
    border-radius: 14px;
    border: 1px solid var(--border);
    background: var(--btn);
    font-size: 16px;
    cursor:pointer;
  }
  .status {
    margin: 8px 0 6px;
    color: var(--muted);
    font-size: 14px;
  }
  audio {
    width: 100%;
    margin-top: 6px;
  }
  .hint {
    margin-top: 10px;
    color: var(--muted);
    font-size: 13px;
  }
</style>
</head>
<body>
  <h1>撮影本番（Injection） 音声ガイド</h1>
  <p class="note">※必ず GitHub Pages（https://○○.github.io/...）のURLで開いてください。iPhoneでは自動再生できないため、下の再生ボタンを押してください。</p>

  <div class="panel">
    <div class="toprow">
      <div class="chip">ステップ選択</div>
    </div>

    <div class="row">
      <select id="stepSelect" aria-label="ステップ選択"></select>
      <button class="navbtn" id="prevBtn" type="button">← 前</button>
      <button class="navbtn" id="nextBtn" type="button">次 →</button>
    </div>

    <div class="sectionlabel">日本語（内容）</div>
    <div class="jptext" id="jpText"></div>

    <div class="sectionlabel">English（Script）</div>
    <div class="entext" id="enText"></div>

    <div class="btnrow">
      <button class="playbtn" id="playBtn" type="button">▶ 再生 / Play</button>
      <button class="ghostbtn" id="pauseBtn" type="button">⏸ 一時停止 / Pause</button>
      <button class="ghostbtn" id="replayBtn" type="button">↻ もう一度 / Replay</button>
    </div>

    <div class="status" id="status">待機中 / Ready</div>

    <audio id="audio" controls preload="metadata">
      <source id="audioSrc" src="" type="audio/mpeg">
      お使いのブラウザでは音声を再生できません。
    </audio>

    <div class="hint">再生されない場合は、上のコントロール（▶）からも再生できます。</div>
  </div>

<script>
  const steps = [{"id": 1, "jp": "これから造影剤を注入します。", "en": "We're going to inject the contrast dye soon."}, {"id": 2, "jp": "気分が悪くなったら、すぐにお知らせください。", "en": "If you feel sick, please let us know right away."}, {"id": 3, "jp": "今から注入を開始します。痛みはありませんか？気分はいかがですか？", "en": "Starting the injection now. Did you feel any pain? How are you feeling?"}, {"id": 4, "jp": "だんだん体が温かく感じてきます。", "en": "You'll start to feel warm gradually."}, {"id": 5, "jp": "「息を止めてください」の指示のあと、すぐに撮影が始まります。", "en": "After you hear the instruction to hold your breath, the scan will start right away."}, {"id": 6, "jp": "約1分後にもう一度撮影します。気分はいかがですか？", "en": "In about one minute, we're going to take another scan. How are you feeling?"}, {"id": 7, "jp": "温かい感じは数分でおさまります。", "en": "The warm sensation will go away in a few minutes."}];
  const audio = document.getElementById('audio');
  const audioSrc = document.getElementById('audioSrc');
  const stepSelect = document.getElementById('stepSelect');
  const jpText = document.getElementById('jpText');
  const enText = document.getElementById('enText');
  const statusEl = document.getElementById('status');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  // Populate dropdown (数字の順番通り)
  steps.forEach(s => {
    const opt = document.createElement('option');
    opt.value = s.id;
    opt.textContent = String(s.id).padStart(2,'0') + '. ' + s.jp;
    stepSelect.appendChild(opt);
  });

  function setStatus(msg) {
    statusEl.textContent = msg;
  }

  function loadStep(id) {
    const idx = steps.findIndex(s => s.id === id);
    const s = steps[idx];
    jpText.textContent = s.jp;
    enText.textContent = s.en;

    // audio file
    const file = 'audio/' + String(s.id).padStart(2,'0') + '.mp3';
    audio.pause();
    audio.currentTime = 0;
    audioSrc.src = file;
    audio.load();

    // nav enable/disable
    prevBtn.disabled = (idx <= 0);
    nextBtn.disabled = (idx >= steps.length - 1);
    setStatus('待機中 / Ready');
  }

  // Button handlers
  document.getElementById('playBtn').addEventListener('click', async () => {
    try {
      await audio.play();
    } catch (e) {
      // iOS/Android may block without user gesture; button click is a gesture, so usually ok.
      console.log(e);
    }
  });
  document.getElementById('pauseBtn').addEventListener('click', () => audio.pause());
  document.getElementById('replayBtn').addEventListener('click', async () => {
    audio.currentTime = 0;
    try {
      await audio.play();
    } catch (e) {
      console.log(e);
    }
  });

  stepSelect.addEventListener('change', () => {
    loadStep(parseInt(stepSelect.value, 10));
  });
  prevBtn.addEventListener('click', () => {
    const cur = parseInt(stepSelect.value, 10);
    loadStep(cur - 1);
    stepSelect.value = String(cur - 1);
  });
  nextBtn.addEventListener('click', () => {
    const cur = parseInt(stepSelect.value, 10);
    loadStep(cur + 1);
    stepSelect.value = String(cur + 1);
  });

  // Audio status
  audio.addEventListener('play', () => setStatus('再生中 / Playing'));
  audio.addEventListener('pause', () => {
    if (audio.currentTime === 0 || audio.ended) {
      setStatus('待機中 / Ready');
    } else {
      setStatus('一時停止 / Paused');
    }
  });
  audio.addEventListener('ended', () => setStatus('再生終了 / Finished'));

  // Initial
  stepSelect.value = "1";
  loadStep(1);
</script>
</body>
</html>
